<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>JLIO Admin Dashboard</title>
    <link rel="icon" type="image/png" href="../assets/images/favicon.png">
    <link rel="stylesheet" href="../assets/admin/admin.css">
    <link rel="stylesheet" href="../assets/admin/admin-ui-improvements.css">
</head>

<body class="dashboard-page">
    <!-- Navigation Header -->
    <nav class="admin-nav">
        <div class="nav-left">
            <img src="../assets/images/logo.png" alt="JLIO" class="nav-logo">
            <h1>JLIO Admin</h1>
        </div>

        <div class="nav-center">
            <div class="nav-tabs">
                <button class="nav-tab" data-page="overview">üìä Overview</button>
                <button class="nav-tab" data-page="stories">üìñ Stories</button>
                <button class="nav-tab" data-page="moderation">üõ°Ô∏è Moderation</button>
                <button class="nav-tab" data-page="security">üîí Security</button>
                <button class="nav-tab" data-page="analytics">üìà Analytics</button>
                <button class="nav-tab" data-page="users">üë• Users</button>
            </div>
        </div>

        <div class="nav-right">
            <div class="admin-info">
                <span id="adminName">Admin</span>
                <button class="logout-btn" id="logoutBtn">üö™ Logout</button>
            </div>
        </div>
    </nav>

    <!-- Main Content -->
    <main class="admin-main">
        <!-- Overview Page -->
        <div class="admin-page active" id="overview-page">
            <div class="page-header">
                <h2>Dashboard Overview</h2>
                <div class="real-time-indicator">
                    <span class="indicator-dot"></span>
                    Live Data
                </div>
            </div>

            <div class="stats-grid">
                <div class="stat-card">
                    <div class="stat-icon">üë•</div>
                    <div class="stat-content">
                        <h3 id="totalUsers">0</h3>
                        <p>Total Users</p>
                        <span class="stat-change" id="usersChange">+0 today</span>
                    </div>
                </div>

                <div class="stat-card">
                    <div class="stat-icon">üí¨</div>
                    <div class="stat-content">
                        <h3 id="totalChats">0</h3>
                        <p>Total Chats</p>
                        <span class="stat-change" id="chatsChange">+0 today</span>
                    </div>
                </div>

                <div class="stat-card">
                    <div class="stat-icon">üìù</div>
                    <div class="stat-content">
                        <h3 id="totalStories">0</h3>
                        <p>Stories Posted</p>
                        <span class="stat-change" id="storiesChange">+0 today</span>
                    </div>
                </div>

                <div class="stat-card">
                    <div class="stat-icon">üö®</div>
                    <div class="stat-content">
                        <h3 id="pendingReports">0</h3>
                        <p>Pending Reports</p>
                        <span class="stat-change urgent" id="reportsChange">Need Review</span>
                    </div>
                </div>
            </div>

            <div class="dashboard-grid">
                <div class="dashboard-card">
                    <h3>Recent Activity</h3>
                    <div class="activity-list" id="recentActivity">
                        <div class="activity-item loading">Loading activities...</div>
                    </div>
                </div>

                <div class="dashboard-card">
                    <h3>Quick Actions</h3>
                    <div class="quick-actions">
                        <button class="action-btn" onclick="switchPage('moderation')">
                            üõ°Ô∏è Review Reports
                        </button>
                        <button class="action-btn" onclick="switchPage('users')">
                            üë• Manage Users
                        </button>
                        <button class="action-btn" onclick="switchPage('analytics')">
                            üìà View Analytics
                        </button>
                    </div>
                </div>
            </div>
        </div>

        <!-- Stories Management Page -->
        <div class="admin-page" id="stories-page">
            <div class="page-header">
                <h2>Stories Management</h2>
                <div class="stories-controls">
                    <input type="text" id="storySearch" placeholder="Search stories by content...">
                    <select id="communityFilter">
                        <option value="all">All Communities</option>
                        <option value="global">Global</option>
                        <option value="local">Local</option>
                    </select>
                    <select id="tagFilter">
                        <option value="all">All Tags</option>
                        <!-- Tags will be populated dynamically -->
                    </select>
                    <select id="sortFilter">
                        <option value="recent">Most Recent</option>
                        <option value="oldest">Oldest First</option>
                        <option value="most_replies">Most Replies</option>
                        <option value="most_reactions">Most Reactions</option>
                    </select>
                    <button class="action-btn" onclick="refreshStories()">üîÑ Refresh</button>
                    <button class="action-btn danger" onclick="bulkDeleteStories()" id="bulkDeleteBtn"
                        style="display:none;">
                        üóëÔ∏è Delete Selected (<span id="selectedCount">0</span>)
                    </button>
                </div>
            </div>

            <div class="stories-stats">
                <div class="stat-card small">
                    <div class="stat-value" id="totalStoriesCount">0</div>
                    <div class="stat-label">Total Stories</div>
                </div>
                <div class="stat-card small">
                    <div class="stat-value" id="globalStoriesCount">0</div>
                    <div class="stat-label">Global Stories</div>
                </div>
                <div class="stat-card small">
                    <div class="stat-value" id="todayStoriesCount">0</div>
                    <div class="stat-label">Today</div>
                </div>
                <div class="stat-card small">
                    <div class="stat-value" id="repliesCount">0</div>
                    <div class="stat-label">Total Replies</div>
                </div>
            </div>

            <div class="bulk-actions-bar" id="bulkActionsBar" style="display:none;">
                <label>
                    <input type="checkbox" id="selectAllStories" onchange="toggleSelectAll()">
                    Select All
                </label>
                <span id="selectionInfo">0 selected</span>
                <button class="action-btn" onclick="clearSelection()">Clear Selection</button>
            </div>

            <div class="stories-container">
                <div class="stories-list" id="storiesList">
                    <div class="loading-placeholder">Loading stories...</div>
                </div>
            </div>

            <!-- Pagination -->
            <div class="pagination" id="storiesPagination" style="display:none;">
                <button onclick="loadStoriesPage('prev')">‚Üê Previous</button>
                <span id="pageInfo">Page 1</span>
                <button onclick="loadStoriesPage('next')">Next ‚Üí</button>
            </div>
        </div>

        <!-- Moderation Page -->
        <div class="admin-page" id="moderation-page">
            <div class="page-header">
                <h2>Content Moderation</h2>
                <div class="moderation-controls">
                    <div class="moderation-filters">
                        <select id="reportFilter">
                            <option value="all">All Reports</option>
                            <option value="pending">Pending</option>
                            <option value="under_review">Under Review</option>
                            <option value="resolved">Resolved</option>
                            <option value="dismissed">Dismissed</option>
                        </select>
                        <select id="priorityFilter">
                            <option value="all">All Priorities</option>
                            <option value="critical">Critical</option>
                            <option value="high">High</option>
                            <option value="medium">Medium</option>
                            <option value="low">Low</option>
                        </select>
                        <select id="categoryFilter">
                            <option value="all">All Categories</option>
                            <option value="message">Messages</option>
                            <option value="user_behavior">User Behavior</option>
                            <option value="voice_note">Voice Notes</option>
                            <option value="general">General</option>
                        </select>
                    </div>
                    <div class="moderation-actions">
                        <button class="action-btn" onclick="ModerationSystem.flagSuspiciousContent()">
                            üîç Auto-Scan Content
                        </button>
                        <button class="action-btn" onclick="exportModerationReport()">
                            üìä Export Report
                        </button>
                        <button class="action-btn" onclick="showBulkActions()">
                            üî® Bulk Actions
                        </button>
                    </div>
                </div>
            </div>

            <div class="moderation-stats">
                <div class="stat-card small">
                    <div class="stat-value" id="totalReports">0</div>
                    <div class="stat-label">Total Reports</div>
                </div>
                <div class="stat-card small">
                    <div class="stat-value" id="criticalReports">0</div>
                    <div class="stat-label">Critical</div>
                </div>
                <div class="stat-card small">
                    <div class="stat-value" id="autoFlagged">0</div>
                    <div class="stat-label">Auto-Flagged</div>
                </div>
                <div class="stat-card small">
                    <div class="stat-value" id="resolvedToday">0</div>
                    <div class="stat-label">Resolved Today</div>
                </div>
            </div>

            <div class="reports-container">
                <div class="reports-list" id="reportsList">
                    <div class="loading-placeholder">Loading reports...</div>
                </div>
            </div>
        </div>

        <!-- Security Page -->
        <div class="admin-page" id="security-page">
            <div class="page-header">
                <h2>Security & Monitoring</h2>
                <div class="security-controls">
                    <button class="action-btn" onclick="runSecurityScan()">
                        üîç Run Security Scan
                    </button>
                    <button class="action-btn" onclick="exportSecurityReport()">
                        üìã Export Report
                    </button>
                    <button class="action-btn" onclick="updateSecurityRules()">
                        ‚öôÔ∏è Update Rules
                    </button>
                </div>
            </div>

            <div class="security-stats">
                <div class="stat-card small">
                    <div class="stat-value" id="totalAlerts">0</div>
                    <div class="stat-label">Security Alerts</div>
                </div>
                <div class="stat-card small">
                    <div class="stat-value" id="criticalAlerts">0</div>
                    <div class="stat-label">Critical</div>
                </div>
                <div class="stat-card small">
                    <div class="stat-value" id="quarantinedUsers">0</div>
                    <div class="stat-label">Quarantined</div>
                </div>
                <div class="stat-card small">
                    <div class="stat-value" id="resolvedToday">0</div>
                    <div class="stat-label">Resolved Today</div>
                </div>
            </div>

            <div class="security-grid">
                <div class="security-card">
                    <h3>Recent Security Alerts</h3>
                    <div class="alerts-list" id="securityAlerts">
                        <div class="loading-placeholder">Loading security alerts...</div>
                    </div>
                </div>

                <div class="security-card">
                    <h3>Threat Patterns</h3>
                    <div class="threat-patterns" id="threatPatterns">
                        <div class="pattern-item">
                            <span class="pattern-type">Spam Detection</span>
                            <span class="pattern-count">12 blocked today</span>
                        </div>
                        <div class="pattern-item">
                            <span class="pattern-type">Rate Limiting</span>
                            <span class="pattern-count">8 users throttled</span>
                        </div>
                        <div class="pattern-item">
                            <span class="pattern-type">Behavioral Analysis</span>
                            <span class="pattern-count">3 suspicious accounts</span>
                        </div>
                    </div>
                </div>
            </div>

            <div class="security-actions">
                <h3>Quick Security Actions</h3>
                <div class="action-grid">
                    <button class="security-action-btn" onclick="bulkQuarantine()">
                        üîí Bulk Quarantine
                    </button>
                    <button class="security-action-btn" onclick="updateThreatPatterns()">
                        üß† Update AI Patterns
                    </button>
                    <button class="security-action-btn" onclick="generateSecurityReport()">
                        üìä Generate Report
                    </button>
                    <button class="security-action-btn" onclick="reviewAuditLog()">
                        üìã Audit Log
                    </button>
                </div>
            </div>
        </div>

        <!-- Analytics Page -->
        <div class="admin-page" id="analytics-page">
            <div class="page-header">
                <h2>Analytics & Insights</h2>
                <div class="analytics-controls">
                    <select id="timeRange">
                        <option value="7">Last 7 days</option>
                        <option value="30">Last 30 days</option>
                        <option value="90">Last 90 days</option>
                    </select>
                </div>
            </div>

            <div class="analytics-grid">
                <div class="chart-card">
                    <h3>User Growth</h3>
                    <canvas id="userGrowthChart"></canvas>
                </div>

                <div class="chart-card">
                    <h3>Daily Activity</h3>
                    <canvas id="activityChart"></canvas>
                </div>

                <div class="chart-card">
                    <h3>Feature Usage</h3>
                    <canvas id="featureChart"></canvas>
                </div>

                <div class="chart-card">
                    <h3>JLios Economy</h3>
                    <canvas id="economyChart"></canvas>
                </div>
            </div>
        </div>

        <!-- Users Page -->
        <div class="admin-page" id="users-page">
            <div class="page-header">
                <h2>User Management</h2>
                <div class="user-controls">
                    <input type="text" id="userSearch" placeholder="Search users...">
                    <select id="userFilter">
                        <option value="all">All Users</option>
                        <option value="active">Active</option>
                        <option value="banned">Banned</option>
                        <option value="new">New (7 days)</option>
                    </select>
                </div>
            </div>

            <div class="users-container">
                <div class="users-list" id="usersList">
                    <div class="loading-placeholder">Loading users...</div>
                </div>
            </div>
        </div>
    </main>

    <!-- Modals -->
    <div class="modal" id="reportModal">
        <div class="modal-content">
            <div class="modal-header">
                <h3>Report Details</h3>
                <button class="modal-close" onclick="closeModal('reportModal')">&times;</button>
            </div>
            <div class="modal-body" id="reportModalBody">
                <!-- Report details will be loaded here -->
            </div>
        </div>
    </div>

    <div class="modal" id="userModal">
        <div class="modal-content">
            <div class="modal-header">
                <h3>User Details</h3>
                <button class="modal-close" onclick="closeModal('userModal')">&times;</button>
            </div>
            <div class="modal-body" id="userModalBody">
                <!-- User details will be loaded here -->
            </div>
        </div>
    </div>

    <div class="modal" id="storyModal">
        <div class="modal-content modal-large">
            <div class="modal-header">
                <h3>Story Details</h3>
                <button class="modal-close" onclick="closeModal('storyModal')">&times;</button>
            </div>
            <div class="modal-body" id="storyModalBody">
                <!-- Story details will be loaded here -->
            </div>
        </div>
    </div>

    <!-- Loading Overlay -->
    <div class="loading-overlay" id="loadingOverlay">
        <div class="loading-spinner"></div>
    </div>

    <!-- Keyboard Shortcuts Hint -->
    <div class="keyboard-hint" id="keyboardHint">
        <strong>‚å®Ô∏è Keyboard Shortcuts:</strong><br>
        <kbd>?</kbd> Show/hide hints &nbsp;
        <kbd>Esc</kbd> Close modals &nbsp;
        <kbd>Del</kbd> Delete selected
    </div>

    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script type="module" src="../assets/admin/dashboard.js"></script>
    <script type="module" src="../assets/admin/admin-api.js"></script>
    <script type="module" src="../assets/admin/stories-management.js"></script>
    <script type="module" src="../assets/admin/keyboard-shortcuts.js"></script>
</body>

</html>